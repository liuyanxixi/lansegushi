<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>姓名作诗页面</title>
<style>
    body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f0f0f0; /* 背景颜色可选 */
    }
    .login-container, .poem-container {
        display: none;
        text-align: center;
    }
    .login-container.active {
        display: block;
    }
    .poem-container.active {
        display: flex;
        width: 80%;
        max-width: 1200px;
    }
    .input-section {
        flex: 2;
        padding-right: 20px;
    }
    .input-section label {
        display: block;
        margin-bottom: 10px;
    }
    .input-section textarea {
        padding: 10px;
        font-size: 16px;
        width: 100%;
        height: 100px;
    }
    .input-section input {
        padding: 10px;
        font-size: 16px;
        width: 100%;
        margin-bottom: 10px;
    }
    .input-section button {
        padding: 10px 20px;
        font-size: 16px;
        background-color: green;
        color: white;
        border: none;
        cursor: pointer;
    }
    .divider {
        width: 1px;
        background-color: #ccc;
    }
    .poem-section {
        flex: 8;
        padding-left: 20px;
    }
    .poem-title {
        font-size: 60px; /* 调整题目字体大小 */
        font-family: 'KaiTi', '楷体', serif; /* 使用楷体 */
        font-weight: bold; /* 加粗所有文字 */
        text-align: center; /* 文字居中 */
        margin-bottom: 20px; /* 题目与古诗之间的间距 */
    }
    .poem {
        font-size: 80px; /* 调整古诗字体大小为80px */
        font-family: 'KaiTi', '楷体', serif; /* 使用楷体 */
        line-height: 1.5; /* 行间距 */
        font-weight: bold; /* 加粗所有文字 */
        text-align: center; /* 文字居中 */
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); /* 添加3D效果 */
        -webkit-font-smoothing: antialiased; /* WebKit浏览器的字体平滑处理 */
        -moz-osx-font-smoothing: grayscale; /* Firefox浏览器的字体平滑处理 */
    }
    .highlight {
        color: blue; /* 高亮显示的颜色 */
    }
    .error-message {
        color: red;
        font-size: 20px;
        margin-top: 10px;
    }
</style>
</head>
<body>
<div class="login-container active">
    <h1>欢迎进入姓名作诗页面</h1>
    <div class="input-section">
        <label for="keyInput">请输入密钥：</label>
        <input type="text" id="keyInput" />
        <button onclick="handleLogin()">登录</button>
        <div id="loginErrorMessage" class="error-message"></div>
    </div>
</div>

<div class="poem-container">
    <div class="input-section">
        <label for="poemInput">请输入古诗：</label>
        <textarea id="poemInput" rows="4" cols="50"></textarea>
        <label for="nameInput">请输入名字：</label>
        <input type="text" id="nameInput" />
        <button onclick="displayPoem()">显示古诗</button>
    </div>
    <div class="divider"></div>
    <div class="poem-section">
        <div id="poemTitle" class="poem-title"></div>
        <div id="poemContainer" class="poem"></div>
    </div>
</div>

<script>
    const correctKey = "secret123"; // 设置正确的密钥
    let currentUser = null; // 当前登录用户

    function handleLogin() {
        const keyInput = document.getElementById('keyInput').value;
        const loginErrorMessage = document.getElementById('loginErrorMessage');
        const loginContainer = document.querySelector('.login-container');
        const poemContainer = document.querySelector('.poem-container');

        if (currentUser) {
            loginErrorMessage.textContent = "已有用户登录，请稍后再试。";
            return;
        }

        if (keyInput !== correctKey) {
            loginErrorMessage.textContent = "密钥错误，请输入正确的密钥。";
            return;
        }

        currentUser = keyInput;
        loginContainer.classList.remove('active');
        poemContainer.classList.add('active');
    }

    function displayPoem() {
        const poemInput = document.getElementById('poemInput').value;
        const nameInput = document.getElementById('nameInput').value;

        const titleContainer = document.getElementById('poemTitle');
        const container = document.getElementById('poemContainer');
        titleContainer.innerHTML = '';
        container.innerHTML = '';

        const bookTitle = `《${nameInput}》`;
        function displayTitle(index, title) {
            if (index < title.length) {
                const char = title[index];
                const charSpan = document.createElement('span');
                charSpan.textContent = char;
                charSpan.style.opacity = 0;
                titleContainer.appendChild(charSpan);
                setTimeout(() => {
                    charSpan.style.opacity = 1;
                }, index * 350);
                setTimeout(() => {
                    displayTitle(index + 1, title);
                }, 350);
            }
        }
        displayTitle(0, bookTitle);

        const lines = poemInput.split(/[\n，。]/).filter(line => line.trim() !== '');
        const nameChars = nameInput.split('');
        const nameLength = nameChars.length;

        function displayLine(lineIndex) {
            if (lineIndex < lines.length) {
                const line = lines[lineIndex].trim();
                const chars = line.split('');
                let isFirstChar = true;

                function displayCharacter(index) {
                    if (index < chars.length) {
                        const char = chars[index];
                        const span = document.createElement('span');
                        span.textContent = char;

                        // 只有在诗句的开头位置，并且与名字中的某个字相匹配时，才添加高亮类
                        if (isFirstChar && lineIndex < nameLength && char === nameChars[lineIndex]) {
                            span.classList.add('highlight');
                        }

                        container.appendChild(span);

                        setTimeout(() => {
                            span.style.opacity = 1;
                        }, 50);

                        if (index === chars.length - 1) {
                            container.appendChild(document.createElement('br'));
                        }

                        isFirstChar = false;
                        setTimeout(() => {
                            displayCharacter(index + 1);
                        }, 350);
                    } else {
                        setTimeout(() => {
                            displayLine(lineIndex + 1);
                        }, 350);
                    }
                }

                displayCharacter(0);
            }
        }

        setTimeout(() => {
            displayLine(0);
        }, bookTitle.length * 350 + 1000);
    }

    // 监听窗口关闭事件，清除当前用户
    window.addEventListener('beforeunload', () => {
        currentUser = null;
    });
</script>
</body>
</html>
